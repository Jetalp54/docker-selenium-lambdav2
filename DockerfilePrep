FROM umihico/aws-lambda-selenium-python:latest

# Copy the Prep Lambda handler
COPY prep_handler.py ${LAMBDA_TASK_ROOT}/

# Ensure correct permissions
RUN chmod 644 ${LAMBDA_TASK_ROOT}/prep_handler.py

# Install required Python dependencies
# Note: The base image already has selenium installed
RUN pip install --no-cache-dir \
    boto3

# Debugging: Check file existence and permissions
RUN echo "=== Checking Lambda Task Root ===" && \
    ls -la ${LAMBDA_TASK_ROOT}/ && \
    echo "=== End Check ==="

# Set environment variables to disable SeleniumManager at container level
ENV SE_SELENIUM_MANAGER=false
ENV SELENIUM_MANAGER=false
ENV SELENIUM_DISABLE_DRIVER_MANAGER=1

# Set the Lambda handler entrypoint
CMD ["prep_handler.handler"]
